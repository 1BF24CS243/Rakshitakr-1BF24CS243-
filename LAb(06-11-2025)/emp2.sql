create database emp
show databases;
use emp;

CREATE TABLE DEPT (
    DEPTNO INT PRIMARY KEY,
    DNAME VARCHAR(50),
    DLOC VARCHAR(50)
);

CREATE TABLE EMPLOYEE (
    EMPNO INT PRIMARY KEY,
    ENAME VARCHAR(50),
    MGR_NO INT,
    HIREDATE DATE,
    SAL DECIMAL(10,2),
    DEPTNO INT,
    FOREIGN KEY (DEPTNO) REFERENCES DEPT(DEPTNO)
);

CREATE TABLE PROJECT (
    PNO INT PRIMARY KEY,
    PNAME VARCHAR(50),
    PLOC VARCHAR(50)
);

CREATE TABLE ASSIGNED_TO (
    EMPNO INT,
    PNO INT,
    JOB_ROLE VARCHAR(50),
    PRIMARY KEY (EMPNO, PNO),
    FOREIGN KEY (EMPNO) REFERENCES EMPLOYEE(EMPNO),
    FOREIGN KEY (PNO) REFERENCES PROJECT(PNO)
);

CREATE TABLE INCENTIVES (
    EMPNO INT,
    INCENTIVE_DATE DATE,
    INCENTIVE_AMOUNT DECIMAL(10,2),
    FOREIGN KEY (EMPNO) REFERENCES EMPLOYEE(EMPNO)
    );

INSERT INTO DEPT VALUES
(10, 'HR', 'Bengaluru'),
(20, 'Finance', 'Hyderabad'),
(30, 'IT', 'Mysuru'),
(40, 'Marketing', 'Chennai'),
(50, 'R&D', 'Delhi'),
(60, 'Support', 'Pune');
select * from DEPT;

INSERT INTO EMPLOYEE VALUES
(101, 'Ananya', NULL, '2020-06-10', 55000, 10),
(102, 'Rahul', 101, '2019-03-15', 60000, 20),
(103, 'Sneha', 102, '2021-02-20', 48000, 30),
(104, 'Vikas', 101, '2018-07-05', 75000, 40),
(105, 'Rohit', 104, '2022-01-10', 42000, 50),
(106, 'Priya', 101, '2020-11-22', 62000, 10),
(107, 'Deepa', 103, '2023-04-10', 50000, 60);
select  * from EMPLOYEE;

INSERT INTO PROJECT VALUES
(1, 'Payroll System', 'Bengaluru'),
(2, 'Inventory Control', 'Hyderabad'),
(3, 'Website Upgrade', 'Mysuru'),
(4, 'Ad Campaign', 'Chennai'),
(5, 'AI Research', 'Delhi'),
(6, 'Customer Portal', 'Pune');
SELECT * FROM PROJECT;

INSERT INTO ASSIGNED_TO VALUES
(101, 1, 'Manager'),
(102, 2, 'Developer'),
(103, 3, 'Analyst'),
(104, 4, 'Designer'),
(105, 5, 'Researcher'),
(106, 1, 'Tester'),
(107, 6, 'Support Engineer'); 
SELECT * FROM ASSIGNED_TO;

INSERT INTO INCENTIVES VALUES
(101, '2024-02-15', 2000),
(102, '2024-03-10', 3000),
(104, '2024-04-20', 2500),
(106, '2024-05-05', 4000),
(107, '2024-06-18', 1800);
INSERT INTO INCENTIVES VALUES
(101, '2019-01-10', 4000),
(102, '2019-01-12', 2500),
(103, '2019-01-15', 3500),
(104, '2019-01-20', 3000),
(105, '2019-01-25', 4500);

SELECT*FROM INCENTIVES;


SELECT * FROM INCENTIVES;

SELECT DISTINCT A.EMPNO
FROM ASSIGNED_TO A
JOIN PROJECT P ON A.PNO = P.PNO
WHERE P.PLOC IN ('Bengaluru', 'Hyderabad', 'Mysuru');


SELECT E.EMPNO
FROM EMPLOYEE E
WHERE E.EMPNO NOT IN (SELECT EMPNO FROM INCENTIVES);

SELECT E.EMPNO,E.ENAME,D.DNAME,A.JOB_ROLE,
D.DLOC AS DEPT_LOCATION,
P.PLOC AS PROJECT_LOCATION
FROM EMPLOYEE E
JOIN DEPT D ON E.DEPTNO=D.DEPTNO
JOIN ASSIGNED_TO A ON E.EMPNO=A.EMPNO
JOIN PROJECT P ON A.PNO=P.PNO WHERE D.DLOC=P.PLOC;

/*list name of manager with max employee*/
SELECT E.ENAME AS Manager_Name
FROM EMPLOYEE E
JOIN EMPLOYEE M ON E.EMPNO = M.MGR_NO
GROUP BY E.ENAME
HAVING COUNT(M.EMPNO) = (
    SELECT MAX(COUNT_SUB)
    FROM (
        SELECT COUNT(MGR_NO) AS COUNT_SUB
        FROM EMPLOYEE
        WHERE MGR_NO IS NOT NULL
        GROUP BY MGR_NO
    ) AS COUNT
);

/*display those manager names who salary is more then avg*/
SELECT M.ENAME AS MANAGER_NAME
FROM EMPLOYEE M
WHERE M.SAL > (
    SELECT AVG(E.SAL)
    FROM EMPLOYEE E
    WHERE E.MGR_NO = M.EMPNO
);

/*find the names of 2nd top level managerts of each deptarment*/
SELECT E.ENAME AS Second_Level_Manager, D.DNAME AS Department
FROM EMPLOYEE E
JOIN EMPLOYEE M ON E.MGR_NO = M.EMPNO
JOIN DEPT D ON E.DEPTNO = D.DEPTNO
WHERE M.MGR_NO IS NULL;

/*Find the employee details who got second maximum incentive in January 2019*/
SELECT E.*
FROM EMPLOYEE E
JOIN INCENTIVES I ON E.EMPNO = I.EMPNO
WHERE I.INCENTIVE_DATE BETWEEN '2019-01-01' AND '2019-01-31'
AND I.INCENTIVE_AMOUNT = (
    SELECT MAX(INCENTIVE_AMOUNT)
    FROM INCENTIVES
    WHERE INCENTIVE_DATE BETWEEN '2019-01-01' AND '2019-01-31'
      AND INCENTIVE_AMOUNT < (
          SELECT MAX(INCENTIVE_AMOUNT)
          FROM INCENTIVES
          WHERE INCENTIVE_DATE BETWEEN '2019-01-01' AND '2019-01-31'
      )
);

/*dsisplay those employees whop are working in same department where their manager is working*/
SELECT E.ENAME AS EMPLOYEE_NAME, E.DEPTNO, M.ENAME AS MANAGER_NAME
FROM EMPLOYEE E
JOIN EMPLOYEE M ON E.MGR_NO = M.EMPNO
WHERE E.DEPTNO = M.DEPTNO;




